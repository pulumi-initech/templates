name: ${PROJECT}
description: ${DESCRIPTION}
runtime: yaml
resources:
  cert:
    type: acm:index:DnsValidatedCertificate
    properties:
      domainName: ${subDomain}.${hostedZoneName}
      zoneId:
        fn::invoke:
          function: aws:route53:getZone
          arguments:
            name: ${hostedZoneName}
          return: zoneId
  web:
    type: web:index:WebEnvironment
    properties:
      vpcId: ${VpcId}
      vpcCidr: ${CidrBlock}
      publicSubnetIds: ${PublicSubnetIds}
      privateSubnetIds: ${PrivateSubnetIds}
      imageId: ${imageId}
      instanceType: ${instanceType}
      instanceCount: ${instanceCount}
      subdomain: ${subDomain}
      scaleInRpsThreshold: ${scaleInRpsThreshold}
      scaleOutRpsThreshold: ${scaleOutRpsThreshold}
      zoneId:
        fn::invoke:
          function: aws:route53:getZone
          arguments:
            name: ${hostedZoneName}
          return: zoneId
      certificateArn: ${cert.certificateArn}
outputs:
  frontendUrl:
    value: https://${web.fqdn}
config:
  scaleInRpsThreshold: 
    default: 500
  scaleOutRpsThreshold:
    default: 1000
