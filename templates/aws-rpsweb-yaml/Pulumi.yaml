name: ${PROJECT}
description: ${DESCRIPTION}
runtime: yaml
template:
  description: An RPS based full-featured web server
  config:
    instanceType:
      type: string
      default: m3.medium
    instanceCount:
      type: integer
      default: 2
    scaleInRpsThreshold: 
      default: 500
    scaleOutRpsThreshold:
      default: 1000
resources:
  cert:
    type: acm:index:DnsValidatedCertificate
    properties:
      domainName: ${subDomain}.${hostedZoneName}
      zoneId:
        fn::invoke:
          function: aws:route53:getZone
          arguments:
            name: ${hostedZoneName}
          return: zoneId
  web:
    type: web:index:WebEnvironment
    properties:
      vpcId: ${VpcId}
      vpcCidr: ${CidrBlock}
      publicSubnetIds: ${PublicSubnetIds}
      privateSubnetIds: ${PrivateSubnetIds}
      imageId: ${imageId}
      instanceType: ${instanceType}
      instanceCount: ${instanceCount}
      subdomain: ${subDomain}
      scaleInRpsThreshold: ${scaleInRpsThreshold}
      scaleOutRpsThreshold: ${scaleOutRpsThreshold}
      certificateArn: ${cert.certificateArn}
      zoneId:
        fn::invoke:
          function: aws:route53:getZone
          arguments:
            name: ${hostedZoneName}
          return: zoneId
outputs:
  frontendUrl:
    value: https://${web.fqdn}
